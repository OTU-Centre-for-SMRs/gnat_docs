<!DOCTYPE html><head><meta charset="UTF-8"><title>Building with the MOOSE Conda Environment | Gnat</title><link href="../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../css/civet_moose.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../contrib/jquery/jquery.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">Gnat</a><a href="https://github.com/OTU-Center-for-SMRs/gnat" class="right"><img src="../media/framework/github-logo.png" class="github-mark"></img><img src="../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="#!" class="dropdown-trigger" data-target="2fff4244-1ee3-443e-977e-b40da0633351" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="789c1a97-aa0e-40a5-a9c7-74520c169829" data-constrainWidth="false">Theory and Implementation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="fc7fbdff-de33-4701-af84-90bb770509f4" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../publications.html">Publications</a></li><li><a href="../contact.html">Contact</a></li></ul><a href="#" class="sidenav-trigger" data-target="45b1c8de-1619-4244-85fa-82cc1ee65e70"><i class="material-icons">menu</i></a><ul class="sidenav" id="45b1c8de-1619-4244-85fa-82cc1ee65e70"><li><a href="#!" class="dropdown-trigger" data-target="0faf9ba7-7ef4-44cb-93a5-843c58520b47" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="edf981ab-e914-4470-b5d0-c831402b5159" data-constrainWidth="false">Theory and Implementation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="eec25c4c-8eba-4054-af43-e8ffb342e95c" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../publications.html">Publications</a></li><li><a href="../contact.html">Contact</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div><ul class="dropdown-content" id="2fff4244-1ee3-443e-977e-b40da0633351"><li><a href="index.html">Installation</a></li><li><a href="../tutorials/index.html">Tutorials</a></li></ul><ul class="dropdown-content" id="789c1a97-aa0e-40a5-a9c7-74520c169829"><li><a href="../about/radiation_transport.html">Radiation Transport</a></li><li><a href="../about/mobile_depletion.html">Fluid Depletion</a></li><li><a href="../about/implementation.html">Implementation</a></li></ul><ul class="dropdown-content" id="fc7fbdff-de33-4701-af84-90bb770509f4"><li><a href="../source/index.html">Gnat Source Pages</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Source Pages</a></li></ul><ul class="dropdown-content" id="0faf9ba7-7ef4-44cb-93a5-843c58520b47"><li><a href="index.html">Installation</a></li><li><a href="../tutorials/index.html">Tutorials</a></li></ul><ul class="dropdown-content" id="edf981ab-e914-4470-b5d0-c831402b5159"><li><a href="../about/radiation_transport.html">Radiation Transport</a></li><li><a href="../about/mobile_depletion.html">Fluid Depletion</a></li><li><a href="../about/implementation.html">Implementation</a></li></ul><ul class="dropdown-content" id="eec25c4c-8eba-4054-af43-e8ffb342e95c"><li><a href="../source/index.html">Gnat Source Pages</a></li><li><a href="https://mooseframework.inl.gov/source/index.html">MOOSE Source Pages</a></li></ul></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="/index.md" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href="." class="breadcrumb">installation</a><a href="#" class="breadcrumb">moose_conda</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="c19225d2-b940-45dc-b74f-dbd16b6947db" data-section-level="1" data-section-text="Building with the MOOSE Conda Environment"><h1 id="building-with-the-moose-conda-environment">Building with the MOOSE Conda Environment</h1><section class="scrollspy" id="3e988b8d-2f8e-479b-9b0d-42aa45ab75f4" data-section-level="2" data-section-text="1 . Installing the MOOSE Environment"><h2 id="1-installing-the-moose-environment">1. Installing the MOOSE Environment</h2><p>Gnat is a MOOSE-based application, and therefore requires an appropriate MOOSE environment. More detailed instructions for installing Mambaforge3 (a dependency manager) can be found on the MOOSE <a href="https://mooseframework.inl.gov/getting_started/installation/conda.html">installation page</a>. You can install Mambaforge3 with the following shell commands:</p><p>Linux:</p><pre class="moose-pre"><code class="language-bash">
curl -L -O https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-Linux-x86_64.sh
bash Mambaforge-Linux-x86_64.sh -b -p ~/mambaforge3
</code></pre><p>Macintosh without Apple Silicon:</p><pre class="moose-pre"><code class="language-bash">
curl -L -O https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-MacOSX-x86_64.sh
bash Mambaforge-MacOSX-x86_64.sh -b -p ~/mambaforge3
</code></pre><p>Macintosh with Apple Silicon:</p><pre class="moose-pre"><code class="language-bash">
curl -L -O https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-MacOSX-arm64.sh
bash Mambaforge-MacOSX-arm64.sh -b -p ~/mambaforge3
</code></pre><p>Once Mambaforge3 has been installed for your platform of choice, you need to configure it to add the MOOSE environment. To do so, add Mambaforge3 to your system PATH:</p><pre class="moose-pre"><code class="language-bash">
export PATH=$HOME/mambaforge3/bin:$PATH
</code></pre><p>Then, add the INL public channel:</p><pre class="moose-pre"><code class="language-bash">
conda config --add channels https://conda.software.inl.gov/public
</code></pre><p>Finally, initialize the Mambaforge3 shell:</p><pre class="moose-pre"><code class="language-bash">
mamba init
</code></pre><p>and create+install the MOOSE environment:</p><pre class="moose-pre"><code class="language-bash">
conda create -n moose moose-dev=2025.05.13=mpich
conda activate moose
</code></pre><p>This will take some time, so feel free to walk away and get yourself a coffee (or other beverage of your choice). Once it&#x27;s complete deactivate your MOOSE environment to ensure the installation is applied.</p><pre class="moose-pre"><code class="language-bash">
mamba deactivate
</code></pre><p>After the installation is finished you can move on to cloning Gnat and MOOSE.</p></section><section class="scrollspy" id="6116442f-5f56-46e1-ba0c-2da9b064c37f" data-section-level="2" data-section-text="2 . Cloning Gnat and MOOSE"><h2 id="2-cloning-gnat-and-moose">2. Cloning Gnat and MOOSE</h2><p>Gnat comes with the MOOSE framework included as a Git submodule. For users who wish to develop applications alongside Gnat, use other sub-applications of Caribou, or use other MOOSE applications: it&#x27;s advised that you install MOOSE separately. This can be done by following all of the detailed instructions on the MOOSE <a href="https://mooseframework.inl.gov/getting_started/installation/conda.html">installation page</a>.</p><p>For users who only wish to use Gnat:</p><pre class="moose-pre"><code class="language-bash">
git clone https://github.com/OTU-Center-for-SMRs/gnat.git
cd gnat
git submodule update --init moose
git submodule update --init include/utils/nuclear_data
</code></pre><p>For users who want to develop/use other MOOSE applications:</p><pre class="moose-pre"><code class="language-bash">
git clone https://github.com/OTU-Center-for-SMRs/gnat.git
git submodule update --init include/utils/nuclear_data
</code></pre><p>Before continuing with the compilation process, ensure that the MOOSE environment has been activated:</p><pre class="moose-pre"><code class="language-bash">
mamba activate moose
</code></pre><p>Once you&#x27;re in the Gnat directory and have activated your MOOSE environment, proceed to the next step.</p></section><section class="scrollspy" id="af5b42b3-2d79-49aa-95ca-5d46f3d8792e" data-section-level="2" data-section-text="3 . Getting Cardinal"><h2 id="3-getting-cardinal">3. Getting Cardinal</h2><p>Gnat allows for neutronics coupling with the continuous-energy Monte Carlo code <a href="https://github.com/openmc-dev/openmc">OpenMC</a> through <a href="https://github.com/neams-th-coe/cardinal">Cardinal</a>. If you don&#x27;t want to build with Cardinal, you can skip this step. If you want to build Gnat with Cardinal, you need to update the Cardinal submodule and fetch it&#x27;s dependencies:</p><pre class="moose-pre"><code class="language-bash">
git submodule update --init cardinal
./cardinal/scripts/get-dependencies.sh
</code></pre><p>In addition to fetching Cardinal&#x27;s dependencies, you&#x27;ll need to export the following environment variables:</p><pre class="moose-pre"><code class="language-bash">
# [REQUIRED] for builds with Cardinal
export ENABLE_CARDINAL=yes

# [REQUIRED WHEN USING THE MOOSE CONDA ENVIRONMENT] you must set the location of the
# root HDF5 directory provided by MOOSE for OpenMC to find
export HDF5_ROOT=$CONDA_PREFIX

# [REQUIRED ON SOME SYSTEMS] for some systems, libraries won&#x27;t be linked properly unless
# you explicitly point this variable. We&#x27;re working on a more elegant fix.
export LD_LIBRARY_PATH=$CONDA_PREFIX/lib:$LD_LIBRARY_PATH

# [OPTIONAL] it&#x27;s a good idea to explicitly note that you are using MPI compiler wrappers
export CC=mpicc
export CXX=mpicxx
export FC=mpif90

# [REQUIRED WHEN RUNNING OPENMC] you will need cross section data at runtime;
# ythis variable must be set to point to a &#x27;cross_sections.xml&#x27; file.
export OPENMC_CROSS_SECTIONS=${HOME}/cross_sections/endfb-vii.1-hdf5/cross_sections.xml
</code></pre></section><section class="scrollspy" id="d08cd8c4-a4ab-48e8-8444-cd09c412a538" data-section-level="2" data-section-text="4 . Building and Testing Gnat"><h2 id="4-building-and-testing-gnat">4. Building and Testing Gnat</h2><p>To build Gnat, you can use the <code>make</code> buildsystem:</p><pre class="moose-pre"><code class="language-bash">
make -j{NUM_PROCESSES}
</code></pre><p>Where <code>{NUM_PROCESSES}</code> is the number of concurrent processes you want building both Gnat and the MOOSE framework. You may also compile a debug version of Gnat by running <code>METHOD=dbg make
-j{NUM_PROCESSES}</code>.</p><p>Finally, run all tests to ensure that Gnat has been built successfully:</p><pre class="moose-pre"><code class="language-bash">
./run_tests -j{NUM_THREADS}
</code></pre><p>Where <code>{NUM_THREADS}</code> is the number of threads you want running tests.</p></section><section class="scrollspy" id="73868b0b-c43c-44b9-a019-06e86ec81a16" data-section-level="2" data-section-text="5 . Run Simulations"><h2 id="5-run-simulations">5. Run Simulations</h2><p>Gnat simulations use the hierarchical input text (HIT) input deck specification designed by INL for MOOSE-based applications. More information about HIT syntax can be found in the <a href="https://mooseframework.inl.gov/getting_started/examples_and_tutorials/tutorial01_app_development/step02_input_file.html#step-2-write-an-input-file">MOOSE tutorials</a>. Gnat input decks can be executed with the following shell command:</p><pre class="moose-pre"><code class="language-bash">
./gnat-opt -i input-file.i
</code></pre><p>Replace <code>input-file.i</code> with the name of your input file. Gnat can be executed in parallel using MPI and the following shell command:</p><pre class="moose-pre"><code class="language-bash">
mpirun -n{NUM_THREADS} ./gnat-opt -i input-file.i
</code></pre><p>Where <code>{NUM_THREADS}</code> is the number of threads you want executing the input deck.</p><p>Now that Gnat has been successfully installed and tested, feel free to check out the <a href="../tutorials/index.html">tutorials</a> to learn how to write a Gnat input deck. </p></section></section></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#3e988b8d-2f8e-479b-9b0d-42aa45ab75f4" class="tooltipped" data-position="left" data-tooltip="1 . Installing the MOOSE Environment">1 . Installing the MOOSE Environment</a></li><li><a href="#6116442f-5f56-46e1-ba0c-2da9b064c37f" class="tooltipped" data-position="left" data-tooltip="2 . Cloning Gnat and MOOSE">2 . Cloning Gnat and MOOSE</a></li><li><a href="#af5b42b3-2d79-49aa-95ca-5d46f3d8792e" class="tooltipped" data-position="left" data-tooltip="3 . Getting Cardinal">3 . Getting Cardinal</a></li><li><a href="#d08cd8c4-a4ab-48e8-8444-cd09c412a538" class="tooltipped" data-position="left" data-tooltip="4 . Building and Testing Gnat">4 . Building and Testing Gnat</a></li><li><a href="#73868b0b-c43c-44b9-a019-06e86ec81a16" class="tooltipped" data-position="left" data-tooltip="5 . Run Simulations">5 . Run Simulations</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../js/init.js"></script><script type="text/javascript" src="../js/navigation.js"></script><script type="text/javascript" src="../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../js/search_index.js"></script><script type="text/javascript" src="../js/sqa_moose.js"></script>